(o=>{window.GFCSAdmin={getDefaultInputs:function(e){for(var i=o.extend(!0,[],gformChainedSelectData.defaultInputs),t=0;t<i.length;t++)i[t].id=e.id+"."+(t+1);return i},updateAlignment:function(e){var i=GetSelectedField();i.chainedSelectsAlignment=e,o("#field_"+i.id).find(".ginput_container").removeClass("horizontal vertical").addClass(e),a(i)}};var e={gform_unique_id:"xxxxxxxx".replace(/[xy]/g,function(e){var i=16*Math.random()|0;return("x"==e?i:3&i|8).toString(16)}),field_id:null,form_id:null};function i(e){e.preventDefault()}function r(e,i){var e=o(e.settings.drop_element),t=o("#gfcs-sample");e.removeClass("gf-dragging"),i?(t.show(),e.show()):(t.hide(),e.hide())}function t(e){var i=plupload.formatSize(e.size).toUpperCase(),t=f(e),s=e.dateUploaded||Math.round(Date.now()/1e3),r=e.isFromFilter?"":'<span class="gfcs-remove"><i class="gficon-subtract"></i></span>',n=e.isFromFilter?`<div class="gfcs-source-message gforms_help_alert"><i class="fa fa-warning"></i> ${gformChainedSelectData.strings.importedFilterFile}</div>`:"";return`
			<div id="${e.id}" class="${t}">
				<span class="gfcs-file-icon"></span> ${e.name} <span class="gfcs-file-size">${i}</span> <span class="gfcs-file-date"> | ${(e=>{var i,t=Date.now()/1e3-e,s={hours:{period:3600,label:{singular:"hour",plural:"hours"}},minutes:{period:60,label:{singular:"min",plural:"mins"}},seconds:{period:1,label:{singular:"sec",plural:"secs"}}};for(i in s)if(s.hasOwnProperty(i)){var r=s[i],n=Math.round(t/r.period),a="";if("hours"==i&&24<=n)break;if("seconds"==i&&0==n)a=`1 ${r.label.singular} ago`;else if(0<n){r=1<n?r.label.plural:r.label.singular;a=n+` ${r} ago`;break}}return a||(e=new Date(1e3*e).toDateString().split(" "),a=e[1]+` ${e[2]}, `+e[3]),a})(s)}</span> <b class="gfcs-file-percent"></b>
				<span class="gfcs-success"><i class="gficon-tick gf_valid"></i></span>
				${r}
				<span class="gfcs-processing"></span>
			</div>
			`+n}function n(e,i){e=o(e.settings.progress);i?e.html(t(i)):e.html("")}function a(e){console.log(e);for(var i=o("#field_"+e.id+" .ginput_container"),t="horizontal"===e.chainedSelectsAlignment?" gform-grid-col--size-auto":"",s="",r=0;r<e.inputs.length;r++){var n=e.inputs[r].id,a=n.replace(".","_"),l="<option>"+e.inputs[r].label+"</option>";s+='<span id="input_'+e.formId+"_"+a+'_container" class="gform-grid-col'+t+'"><select name="input_'+n+'" id="input_'+e.formId+"_"+a+'" disabled="disabled">'+l+"</select></span>\n"}i.html(s)}function l(e){var i=GetSelectedField();return i&&(void 0===e.field||e.field.id==i.id)}function d(e){e.stop(),e.refresh(),e.start()}function c(e){e.files.splice(0,e.files.length),e.refresh(),e.start();var i=GetFieldById(e.field.id);i.choices=gformChainedSelectData.defaultChoices,i.inputs=g(i),i.gfcsFile=null,a(i),n(e,!1),r(e,!0)}function g(e){for(var i=o.extend(!0,[],gformChainedSelectData.defaultInputs),t=0;t<i.length;t++)i[t].id=e.id+"."+(t+1);return i}function f(e){return"gfcs-status-"+(e=>e.status&&e.status==plupload.UPLOADING?100==e.percent?"processing":"uploading":"complete")(e)}function p(e,i){delete window.gfcsErrorTimeout,o("#gfcs-error").remove();var t=o(`<div id="gfcs-error" class="error" style="width:375px;padding:1px 12px;"><p>${i}</p></div>`);o(e.settings.progress).html(t),window.gfcsErrorTimeout=setTimeout(function(){t.slideUp(function(){t.remove()})},1e4)}e["_gform_file_upload_nonce_"+form.id]=window.gform_chainedselects_file_upload_nonce,new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:document.getElementById("pickfiles"),container:document.getElementById("gfcs-container"),progress:document.getElementById("gfcs-progress"),drop_element:document.getElementById("gfcs-drop"),dragdrop:!0,url:gformChainedSelectData.fileUploadUrl,filters:{max_file_size:parseInt(gformChainedSelectData.maxFileSize)/1e6+"mb",mime_types:[{title:"",extensions:"csv"}]},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap",multipart_params:e,init:{PostInit:function(s){o(document).bind("gform_load_field_settings",function(e,i,t){l(s)||d(s),"chainedselect"==i.type&&(i.gfcsFilterEnabled&&!i.gfcsFile?(o(s.settings.progress).html(`<div class="gfcs-source-message gforms_red_alert"><i class="fa fa-warning"></i> ${gformChainedSelectData.strings.errorImportingFilterFile}</div>`),r(s,!1)):(s.field=o.extend({},i),document.getElementById("gfcs-progress").innerHTML="",i.gfcsFile?(n(s,i.gfcsFile),r(s,!1)):c(s)))}),o(s.settings.drop_element).on("dragover",function(){o(this).addClass("gf-dragging")}).on("dragleave",function(){o(this).removeClass("gf-dragging")}),o(s.settings.drop_element).on({dragenter:i,dragover:i}),o(s.settings.progress).on("click","span.gfcs-remove",function(){s.field.gfcsFilterEnabled||c(s)}),gform.addFilter("gform_duplicate_field_chainedselect",function(e){return e.gfcsFilterEnabled&&(e.gfcsFile=null,e.gfcsFilterEnabled=!1,e.choices=gformChainedSelectData.defaultChoices,e.inputs=g(e)),e})},FilesAdded:function(s,e){r(s,!1);var t,i=s.files.length;e=s.files,1<i&&(t=e.length-1,o.each(e,function(e,i){e<t&&s.removeFile(i)})),o.each(e,function(e,i){var t;i.status==plupload.FAILED?s.removeFile(i):(n(s,i),o("#"+i.id).attr("class",f(i)),(t=s.getOption("multipart_params")).field_id=field.id,t.form_id=form.id,t.original_filename=i.name,s.setOption("multipart_params",t))}),s.refresh(),s.start()},UploadProgress:function(e,i){l(e)?(document.getElementById(i.id).getElementsByTagName("b")[0].innerHTML="<span>"+i.percent+"%</span>",o("#"+i.id).attr("class",f(i))):d(e)},Error:function(e,i){c(e);var t=i.message;-601==i.code?t=gformChainedSelectData.strings.errorFileType:-600==i.code&&(t=gformChainedSelectData.strings.errorFileSize),p(e,gformChainedSelectData.strings.errorUploadingFile+"<br>Error: "+i.code+", Message: "+t)},FileUploaded:function(e,i,t){var s;try{s=o.secureEvalJSON(t.response)}catch(e){s={status:"error",error:{message:!1}}}"error"==s.status?(c(e),p(e,gformChainedSelectData.strings.errorProcessingFile+"<br>Error: "+s.error.code+", Message: "+s.error.message)):100==i.percent&&s.status&&"ok"==s.status&&((t=GetSelectedField()).choices=s.data.choices,t.inputs=s.data.inputs,t.gfcsFile={name:i.name,type:i.type,size:i.size,dateUploaded:Math.round((new Date).getTime()/1e3),isFromFilter:!1},a(t),o("#"+i.id).attr("class",f(i)))}}}).init()})(jQuery);
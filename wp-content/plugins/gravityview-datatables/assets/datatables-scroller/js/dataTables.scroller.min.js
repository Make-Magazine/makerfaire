!function(factory){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function($){return factory($,window,document)}):"object"==typeof exports?module.exports=function(root,$){return root||(root=window),$&&$.fn.dataTable||($=require("datatables.net")(root,$).$),factory($,root,root.document)}:factory(jQuery,window,document)}(function($,window,document,undefined){"use strict";var DataTable=$.fn.dataTable,Scroller=function(dt,opts){if(!(this instanceof Scroller))return void alert("Scroller warning: Scroller must be initialised with the 'new' keyword.");opts===undefined&&(opts={});var dtApi=$.fn.dataTable.Api(dt);this.s={dt:dtApi.settings()[0],dtApi:dtApi,tableTop:0,tableBottom:0,redrawTop:0,redrawBottom:0,autoHeight:!0,viewportRows:0,stateTO:null,stateSaveThrottle:function(){},drawTO:null,heights:{jump:null,page:null,virtual:null,scroll:null,row:null,viewport:null,labelFactor:1},topRowFloat:0,scrollDrawDiff:null,loaderVisible:!1,forceReposition:!1,baseRowTop:0,baseScrollTop:0,mousedown:!1,lastScrollTop:0},this.s=$.extend(this.s,Scroller.oDefaults,opts),this.s.heights.row=this.s.rowHeight,this.dom={force:document.createElement("div"),label:$('<div class="dts_label">0</div>'),scroller:null,table:null,loader:null},this.s.dt.oScroller||(this.s.dt.oScroller=this,this.construct())};$.extend(Scroller.prototype,{measure:function(redraw){this.s.autoHeight&&this._calcRowHeight();var heights=this.s.heights;heights.row&&(heights.viewport=this._parseHeight($(this.dom.scroller).css("max-height")),this.s.viewportRows=parseInt(heights.viewport/heights.row,10)+1,this.s.dt._iDisplayLength=this.s.viewportRows*this.s.displayBuffer);var label=this.dom.label.outerHeight();heights.labelFactor=(heights.viewport-label)/heights.scroll,(redraw===undefined||redraw)&&this.s.dt.oInstance.fnDraw(!1)},pageInfo:function(){var dt=this.s.dt,iScrollTop=this.dom.scroller.scrollTop,iTotal=dt.fnRecordsDisplay(),iPossibleEnd=Math.ceil(this.pixelsToRow(iScrollTop+this.s.heights.viewport,!1,this.s.ani));return{start:Math.floor(this.pixelsToRow(iScrollTop,!1,this.s.ani)),end:iTotal<iPossibleEnd?iTotal-1:iPossibleEnd-1}},pixelsToRow:function(pixels,intParse,virtual){var diff=pixels-this.s.baseScrollTop,row=virtual?(this._domain("physicalToVirtual",this.s.baseScrollTop)+diff)/this.s.heights.row:diff/this.s.heights.row+this.s.baseRowTop;return intParse||intParse===undefined?parseInt(row,10):row},rowToPixels:function(rowIdx,intParse,virtual){var pixels,diff=rowIdx-this.s.baseRowTop;return virtual?(pixels=this._domain("virtualToPhysical",this.s.baseScrollTop),pixels+=diff*this.s.heights.row):(pixels=this.s.baseScrollTop,pixels+=diff*this.s.heights.row),intParse||intParse===undefined?parseInt(pixels,10):pixels},scrollToRow:function(row,animate){var that=this,ani=!1,px=this.rowToPixels(row),preRows=(this.s.displayBuffer-1)/2*this.s.viewportRows,drawRow=row-preRows;drawRow<0&&(drawRow=0),(px>this.s.redrawBottom||px<this.s.redrawTop)&&this.s.dt._iDisplayStart!==drawRow&&(ani=!0,px=this._domain("virtualToPhysical",row*this.s.heights.row),this.s.redrawTop<px&&px<this.s.redrawBottom&&(this.s.forceReposition=!0,animate=!1)),animate===undefined||animate?(this.s.ani=ani,$(this.dom.scroller).animate({scrollTop:px},function(){setTimeout(function(){that.s.ani=!1},250)})):$(this.dom.scroller).scrollTop(px)},construct:function(){var that=this,dt=this.s.dtApi;if(!this.s.dt.oFeatures.bPaginate)return void this.s.dt.oApi._fnLog(this.s.dt,0,"Pagination must be enabled for Scroller");this.dom.force.style.position="relative",this.dom.force.style.top="0px",this.dom.force.style.left="0px",this.dom.force.style.width="1px",this.dom.scroller=$("div."+this.s.dt.oClasses.sScrollBody,this.s.dt.nTableWrapper)[0],this.dom.scroller.appendChild(this.dom.force),this.dom.scroller.style.position="relative",this.dom.table=$(">table",this.dom.scroller)[0],this.dom.table.style.position="absolute",this.dom.table.style.top="0px",this.dom.table.style.left="0px",$(dt.table().container()).addClass("dts DTS"),this.s.loadingIndicator&&(this.dom.loader=$('<div class="dataTables_processing dts_loading">'+this.s.dt.oLanguage.sLoadingRecords+"</div>").css("display","none"),$(this.dom.scroller.parentNode).css("position","relative").append(this.dom.loader)),this.dom.label.appendTo(this.dom.scroller),this.s.heights.row&&"auto"!=this.s.heights.row&&(this.s.autoHeight=!1),this.s.ingnoreScroll=!0,$(this.dom.scroller).on("scroll.dt-scroller",function(e){that._scroll.call(that)}),$(this.dom.scroller).on("touchstart.dt-scroller",function(){that._scroll.call(that)}),$(this.dom.scroller).on("mousedown.dt-scroller",function(){that.s.mousedown=!0}).on("mouseup.dt-scroller",function(){that.s.labelVisible=!1,that.s.mousedown=!1,that.dom.label.css("display","none")}),$(window).on("resize.dt-scroller",function(){that.measure(!1),that._info()});var initialStateSave=!0,loadedState=dt.state.loaded();dt.on("stateSaveParams.scroller",function(e,settings,data){initialStateSave&&loadedState?(data.scroller=loadedState.scroller,initialStateSave=!1):data.scroller={topRow:that.s.topRowFloat,baseScrollTop:that.s.baseScrollTop,baseRowTop:that.s.baseRowTop,scrollTop:that.s.lastScrollTop}}),loadedState&&loadedState.scroller&&(this.s.topRowFloat=loadedState.scroller.topRow,this.s.baseScrollTop=loadedState.scroller.baseScrollTop,this.s.baseRowTop=loadedState.scroller.baseRowTop),this.measure(!1),that.s.stateSaveThrottle=that.s.dt.oApi._fnThrottle(function(){that.s.dtApi.state.save()},500),dt.on("init.scroller",function(){that.measure(!1),that.s.scrollType="jump",that._draw(),dt.on("draw.scroller",function(){that._draw()})}),dt.on("preDraw.dt.scroller",function(){that._scrollForce()}),dt.on("destroy.scroller",function(){$(window).off("resize.dt-scroller"),$(that.dom.scroller).off(".dt-scroller"),$(that.s.dt.nTable).off(".scroller"),$(that.s.dt.nTableWrapper).removeClass("DTS"),$("div.DTS_Loading",that.dom.scroller.parentNode).remove(),that.dom.table.style.position="",that.dom.table.style.top="",that.dom.table.style.left=""})},_calcRowHeight:function(){var dt=this.s.dt,origTable=dt.nTable,nTable=origTable.cloneNode(!1),tbody=$("<tbody/>").appendTo(nTable),container=$('<div class="'+dt.oClasses.sWrapper+' DTS"><div class="'+dt.oClasses.sScrollWrapper+'"><div class="'+dt.oClasses.sScrollBody+'"></div></div></div>');$("tbody tr:lt(4)",origTable).clone().appendTo(tbody);var rowsCount=$("tr",tbody).length;if(1===rowsCount)tbody.prepend("<tr><td>&#160;</td></tr>"),tbody.append("<tr><td>&#160;</td></tr>");else for(;rowsCount<3;rowsCount++)tbody.append("<tr><td>&#160;</td></tr>");$("div."+dt.oClasses.sScrollBody,container).append(nTable);var insertEl=this.s.dt.nHolding||origTable.parentNode;$(insertEl).is(":visible")||(insertEl="body"),container.find("input").removeAttr("name"),container.appendTo(insertEl),this.s.heights.row=$("tr",tbody).eq(1).outerHeight(),container.remove()},_draw:function(){var that=this,heights=this.s.heights,iScrollTop=this.dom.scroller.scrollTop,iTableHeight=$(this.s.dt.nTable).height(),displayStart=this.s.dt._iDisplayStart,displayLen=this.s.dt._iDisplayLength,displayEnd=this.s.dt.fnRecordsDisplay();this.s.skip=!0,!this.s.dt.bSorted&&!this.s.dt.bFiltered||0!==displayStart||this.s.dt._drawHold||(this.s.topRowFloat=0),iScrollTop="jump"===this.s.scrollType?this._domain("virtualToPhysical",this.s.topRowFloat*heights.row):iScrollTop,this.s.baseScrollTop=iScrollTop,this.s.baseRowTop=this.s.topRowFloat;var tableTop=iScrollTop-(this.s.topRowFloat-displayStart)*heights.row;0===displayStart?tableTop=0:displayStart+displayLen>=displayEnd&&(tableTop=heights.scroll-iTableHeight),this.dom.table.style.top=tableTop+"px",this.s.tableTop=tableTop,this.s.tableBottom=iTableHeight+this.s.tableTop;var boundaryPx=(iScrollTop-this.s.tableTop)*this.s.boundaryScale;if(this.s.redrawTop=iScrollTop-boundaryPx,this.s.redrawBottom=iScrollTop+boundaryPx>heights.scroll-heights.viewport-heights.row?heights.scroll-heights.viewport-heights.row:iScrollTop+boundaryPx,this.s.skip=!1,this.s.dt.oFeatures.bStateSave&&null!==this.s.dt.oLoadedState&&void 0!==this.s.dt.oLoadedState.scroller){var ajaxSourced=!(!this.s.dt.sAjaxSource&&!that.s.dt.ajax||this.s.dt.oFeatures.bServerSide);(ajaxSourced&&2==this.s.dt.iDraw||!ajaxSourced&&1==this.s.dt.iDraw)&&setTimeout(function(){$(that.dom.scroller).scrollTop(that.s.dt.oLoadedState.scroller.scrollTop),setTimeout(function(){that.s.ingnoreScroll=!1},0)},0)}else that.s.ingnoreScroll=!1;this.s.dt.oFeatures.bInfo&&setTimeout(function(){that._info.call(that)},0),this.dom.loader&&this.s.loaderVisible&&(this.dom.loader.css("display","none"),this.s.loaderVisible=!1)},_domain:function(dir,val){var diff,heights=this.s.heights,magic=1e4;if(heights.virtual===heights.scroll)return val;if(val<magic)return val;if("virtualToPhysical"===dir&&val>=heights.virtual-magic)return diff=heights.virtual-val,heights.scroll-diff;if("physicalToVirtual"===dir&&val>=heights.scroll-magic)return diff=heights.scroll-val,heights.virtual-diff;var m=(heights.virtual-magic-magic)/(heights.scroll-magic-magic),c=magic-m*magic;return"virtualToPhysical"===dir?(val-c)/m:m*val+c},_info:function(){if(this.s.dt.oFeatures.bInfo){var sOut,dt=this.s.dt,language=dt.oLanguage,iScrollTop=this.dom.scroller.scrollTop,iStart=Math.floor(this.pixelsToRow(iScrollTop,!1,this.s.ani)+1),iMax=dt.fnRecordsTotal(),iTotal=dt.fnRecordsDisplay(),iPossibleEnd=Math.ceil(this.pixelsToRow(iScrollTop+this.s.heights.viewport,!1,this.s.ani)),iEnd=iTotal<iPossibleEnd?iTotal:iPossibleEnd,sStart=dt.fnFormatNumber(iStart),sEnd=dt.fnFormatNumber(iEnd),sMax=dt.fnFormatNumber(iMax),sTotal=dt.fnFormatNumber(iTotal);sOut=0===dt.fnRecordsDisplay()&&dt.fnRecordsDisplay()==dt.fnRecordsTotal()?language.sInfoEmpty+language.sInfoPostFix:0===dt.fnRecordsDisplay()?language.sInfoEmpty+" "+language.sInfoFiltered.replace("_MAX_",sMax)+language.sInfoPostFix:dt.fnRecordsDisplay()==dt.fnRecordsTotal()?language.sInfo.replace("_START_",sStart).replace("_END_",sEnd).replace("_MAX_",sMax).replace("_TOTAL_",sTotal)+language.sInfoPostFix:language.sInfo.replace("_START_",sStart).replace("_END_",sEnd).replace("_MAX_",sMax).replace("_TOTAL_",sTotal)+" "+language.sInfoFiltered.replace("_MAX_",dt.fnFormatNumber(dt.fnRecordsTotal()))+language.sInfoPostFix;var callback=language.fnInfoCallback;callback&&(sOut=callback.call(dt.oInstance,dt,iStart,iEnd,iMax,iTotal,sOut));var n=dt.aanFeatures.i;if(void 0!==n)for(var i=0,iLen=n.length;i<iLen;i++)$(n[i]).html(sOut);$(dt.nTable).triggerHandler("info.dt")}},_parseHeight:function(cssHeight){var height,matches=/^([+-]?(?:\d+(?:\.\d+)?|\.\d+))(px|em|rem|vh)$/.exec(cssHeight);if(null===matches)return 0;var value=parseFloat(matches[1]),unit=matches[2];return"px"===unit?height=value:"vh"===unit?height=value/100*$(window).height():"rem"===unit?height=value*parseFloat($(":root").css("font-size")):"em"===unit&&(height=value*parseFloat($("body").css("font-size"))),height||0},_scroll:function(){var iTopRow,that=this,heights=this.s.heights,iScrollTop=this.dom.scroller.scrollTop;if(!this.s.skip&&!this.s.ingnoreScroll&&iScrollTop!==this.s.lastScrollTop){if(this.s.dt.bFiltered||this.s.dt.bSorted)return void(this.s.lastScrollTop=0);if(this._info(),clearTimeout(this.s.stateTO),this.s.stateTO=setTimeout(function(){that.s.dtApi.state.save()},250),this.s.scrollType=Math.abs(iScrollTop-this.s.lastScrollTop)>heights.viewport?"jump":"cont",this.s.topRowFloat="cont"===this.s.scrollType?this.pixelsToRow(iScrollTop,!1,!1):this._domain("physicalToVirtual",iScrollTop)/heights.row,this.s.topRowFloat<0&&(this.s.topRowFloat=0),this.s.forceReposition||iScrollTop<this.s.redrawTop||iScrollTop>this.s.redrawBottom){var preRows=Math.ceil((this.s.displayBuffer-1)/2*this.s.viewportRows);if(iTopRow=parseInt(this.s.topRowFloat,10)-preRows,this.s.forceReposition=!1,iTopRow<=0?iTopRow=0:iTopRow+this.s.dt._iDisplayLength>this.s.dt.fnRecordsDisplay()?(iTopRow=this.s.dt.fnRecordsDisplay()-this.s.dt._iDisplayLength)<0&&(iTopRow=0):iTopRow%2!=0&&iTopRow++,this.s.targetTop=iTopRow,iTopRow!=this.s.dt._iDisplayStart){this.s.tableTop=$(this.s.dt.nTable).offset().top,this.s.tableBottom=$(this.s.dt.nTable).height()+this.s.tableTop;var draw=function(){that.s.dt._iDisplayStart=that.s.targetTop,that.s.dt.oApi._fnDraw(that.s.dt)};this.s.dt.oFeatures.bServerSide?(this.s.forceReposition=!0,clearTimeout(this.s.drawTO),this.s.drawTO=setTimeout(draw,this.s.serverWait)):draw(),this.dom.loader&&!this.s.loaderVisible&&(this.dom.loader.css("display","block"),this.s.loaderVisible=!0)}}else this.s.topRowFloat=this.pixelsToRow(iScrollTop,!1,!0);this.s.lastScrollTop=iScrollTop,this.s.stateSaveThrottle(),"jump"===this.s.scrollType&&this.s.mousedown&&(this.s.labelVisible=!0),this.s.labelVisible&&this.dom.label.html(this.s.dt.fnFormatNumber(parseInt(this.s.topRowFloat,10)+1)).css("top",iScrollTop+iScrollTop*heights.labelFactor).css("display","block")}},_scrollForce:function(){var heights=this.s.heights,max=1e6;heights.virtual=heights.row*this.s.dt.fnRecordsDisplay(),heights.scroll=heights.virtual,heights.scroll>max&&(heights.scroll=max),this.dom.force.style.height=heights.scroll>this.s.heights.row?heights.scroll+"px":this.s.heights.row+"px"}}),Scroller.defaults={boundaryScale:.5,displayBuffer:9,loadingIndicator:!1,rowHeight:"auto",serverWait:200},Scroller.oDefaults=Scroller.defaults,Scroller.version="2.0.3",$(document).on("preInit.dt.dtscroller",function(e,settings){if("dt"===e.namespace){var init=settings.oInit.scroller,defaults=DataTable.defaults.scroller;if(init||defaults){var opts=$.extend({},init,defaults);!1!==init&&new Scroller(settings,opts)}}}),$.fn.dataTable.Scroller=Scroller,$.fn.DataTable.Scroller=Scroller;var Api=$.fn.dataTable.Api;return Api.register("scroller()",function(){return this}),Api.register("scroller().rowToPixels()",function(rowIdx,intParse,virtual){var ctx=this.context;if(ctx.length&&ctx[0].oScroller)return ctx[0].oScroller.rowToPixels(rowIdx,intParse,virtual)}),Api.register("scroller().pixelsToRow()",function(pixels,intParse,virtual){var ctx=this.context;if(ctx.length&&ctx[0].oScroller)return ctx[0].oScroller.pixelsToRow(pixels,intParse,virtual)}),Api.register(["scroller().scrollToRow()","scroller.toPosition()"],function(idx,ani){return this.iterator("table",function(ctx){ctx.oScroller&&ctx.oScroller.scrollToRow(idx,ani)}),this}),Api.register("row().scrollTo()",function(ani){var that=this;return this.iterator("row",function(ctx,rowIdx){if(ctx.oScroller){var displayIdx=that.rows({order:"applied",search:"applied"}).indexes().indexOf(rowIdx);ctx.oScroller.scrollToRow(displayIdx,ani)}}),this}),Api.register("scroller.measure()",function(redraw){return this.iterator("table",function(ctx){ctx.oScroller&&ctx.oScroller.measure(redraw)}),this}),Api.register("scroller.page()",function(){var ctx=this.context;if(ctx.length&&ctx[0].oScroller)return ctx[0].oScroller.pageInfo()}),Scroller});
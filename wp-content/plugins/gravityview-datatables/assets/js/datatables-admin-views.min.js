!function($){var gvDataTablesExt={has_tabs:null,init:function(){gvDataTablesExt.has_tabs=$("#gravityview_settings").data("ui-tabs"),$("#gravityview_directory_template").on("change",gvDataTablesExt.toggleMetaboxAndRowGroup).trigger("change"),$("#datatables_settingsbuttons, #datatables_settingsscroller, #datatables_settingsauto_update, #datatables_settingsrowgroup").on("change",gvDataTablesExt.showGroupOptions).trigger("change"),$("body").on("gravityview/settings/tab/enable",gvDataTablesExt.showMetabox).on("gravityview/settings/tab/disable",gvDataTablesExt.hideMetabox).on("gravityview/field-added",load_row_group_with_fields).on("sortupdate","#directory-active-fields .active-drop",load_row_group_with_fields).on("gravityview/field-added",gvDataTablesExt.setFilterFields).on("gravityview/field-removed",gvDataTablesExt.setFilterFields).on("gravityview/all-fields-removed",gvDataTablesExt.setFilterFields).on("gravityview/view-config-updated",gvDataTablesExt.setFilterFields).on("gravityview/dialog-closed",gvDataTablesExt.setFilterFields)},setFilterFields:function(){const fieldUIDtoLabelMap={},$fieldsWithFilterSettingsEl=($("#directory-active-fields .active-drop > div.gv-fields").each(function(){var $fieldLabelEl=$(this).find(".field-label");$fieldLabelEl.length&&($fieldLabelEl=$fieldLabelEl.attr("name").match(/\[directory_table-columns\]\[(.*?)\]/))&&$fieldLabelEl[1]&&(fieldUIDtoLabelMap[$fieldLabelEl[1].replace(/[^a-z\d]/,"")]=$(this).find(".gv-field-label-text-container").text())}),$("#datatables_settingsfields_with_filter"));var previouslySelectedFields=$fieldsWithFilterSettingsEl.val();if($.isEmptyObject(fieldUIDtoLabelMap))$fieldsWithFilterSettingsEl.empty(),$fieldsWithFilterSettingsEl.parents("tr").hide();else{const existingOptions=$fieldsWithFilterSettingsEl.find("option").map(function(){return this.value}).get(),previouslySelectedFieldsSet=new Set(previouslySelectedFields);$fieldsWithFilterSettingsEl.empty(),$.each(fieldUIDtoLabelMap,function(key,value){var isSelected=previouslySelectedFieldsSet.has(key)||!existingOptions.includes(key);$fieldsWithFilterSettingsEl.append($("<option>",{value:key,text:value}).prop("selected",isSelected))}),$fieldsWithFilterSettingsEl.parents("tr").show()}},toggleMetaboxAndRowGroup:function(){var template=$("#gravityview_directory_template").val(),$setting=$("#gravityview_datatables_settings");"datatables_table"===template?($("body").trigger("gravityview/settings/tab/enable",$setting),load_row_group_with_fields()):$("body").trigger("gravityview/settings/tab/disable",$setting)},showMetabox:function(event,tab){gvDataTablesExt.has_tabs||$(tab).slideDown("fast")},hideMetabox:function(event,tab){gvDataTablesExt.has_tabs||$(tab).slideUp("fast")},showGroupOptions:function(){var _this=$(this);_this.is(":checked")?_this.parents("tr").siblings().fadeIn():_this.parents("tr").siblings().fadeOut(100)}};function load_row_group_with_fields(){var active_fields=$("#directory-active-fields .active-drop > div.gv-fields"),settings_field=$("#datatables_settingsrowgroup_field"),selected_value=settings_field.find(":selected").index(),options=[];active_fields.each(function(i,elem){var elem=$(elem),field_id=elem.find(".field-key").val();GV_DataTables_Admin.internal_fields.hasOwnProperty(field_id)||(field_id=elem.find(".gv-field-label-text-container").text(),elem=elem.find(".gv-field-label").data("original-title"),options.push(field_id||elem))}),settings_field.empty(),0!==options.length&&$.each(options,function(i,val){settings_field.append($("<option>",{value:i,text:val,selected:i===selected_value}))})}$(document).ready(function(){gvDataTablesExt.init()})}(jQuery);
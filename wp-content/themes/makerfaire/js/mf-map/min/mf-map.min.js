"use strict";function formatDate(e){var t=new Date(e),a=t.getDate(),o=t.getMonth(),n=t.getFullYear();return["January","February","March","April","May","June","July","August","September","October","November","December"][o]+", "+a+" "+n}jQuery(document).ready(function(){Vue.use(VueTables.ClientTable),Vue.use(VueTables.Event);new Vue({el:"#directory",data:{columns:["mmap_date","mmap_eventname","physLoc","mmap_country","mmap_city","mmap_state","mmap_start_dt","mmap_end_dt"],tableData:[],options:{headings:{mmap_date:"Date",mmap_eventname:"Name",physLoc:"Location",mmap_country:"Country"},templates:{physLoc:function(e,t,a){var o=t.mmap_city;return t.mmap_state&&(o+=", "+t.mmap_state),o},mmap_date:function(e,t,a){var o=formatDate(t.mmap_start_dt);return t.mmap_end_dt!=t.mmap_start_dt&&(o+=" - "+formatDate(t.mmap_end_dt)),o}},columnsDisplay:{mmap_country:"desktop"},columnsClasses:{mmap_eventname:"col-name",physLoc:"col-location",mmap_country:"col-country",mmap_date:"col-date",mmap_city:"col-hidden",mmap_state:"col-hidden",mmap_start_dt:"col-hidden",mmap_end_dt:"col-hidden"},pagination:{chunk:5}},filterVal:"",map:null,mapDefaultZoom:2,mapDefaultPos:{lat:29.1070772,lng:-24.2299966},markers:""},created:function(){var t=this;axios.get("/wp-json/makemap/v1/mapdata/242").then(function(e){t.$refs.loadingIndicator.classList.add("hidden"),t.tableData=e.data.Locations,t.$refs.directoryGrid.setOrder("mmap_eventname",!0),t.detectBrowser(),t.getLocation(),t.initMap()}).catch(function(e){console.log(e),t.$refs.loadingIndicator.classList.add("hidden"),t.$refs.errorIndicator.classList.remove("hidden")})},methods:{detectBrowser:function(){var e=navigator.userAgent,t=this.$refs.map;-1!=e.indexOf("iPhone")||-1!=e.indexOf("Android")?(t.style.width="100%",t.style.height="300px"):(t.style.width="100%",t.style.height="400px")},initMap:function(){this.$refs.mapTableWrapper.classList.remove("map-table-hidden");var e=this.$refs.map,t={center:this.mapDefaultPos,zoom:this.mapDefaultZoom};this.map=new google.maps.Map(e,t),this.addMarkers()},getLocation:function(){var e=new google.maps.InfoWindow,a=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};a.map.setCenter(t),a.map.setZoom(8)},function(){a.handleLocationError(!0,e,a.map.getCenter())}):a.handleLocationError(!1,e,a.map.getCenter())},handleLocationError:function(e,t,a){console.error("User location check failed")},doFilter:function(e){this.$refs.directoryGrid.setFilter(this.filterVal),this.addMarkers()},filterOverride:function(e){e.preventDefault()},onRowClick:function(e){var t={lat:parseFloat(e.row.mmap_lat),lng:parseFloat(e.row.mmap_lng)};this.map.panTo(t),this.map.setZoom(16)},addMarkers:function(){this.markers=this.tableData.map(function(e,t){var a={lat:parseFloat(e.mmap_lat),lng:parseFloat(e.mmap_lng)},o=new google.maps.Marker({position:a,label:""});return o.addListener("click",function(){new google.maps.InfoWindow({content:'<div style=""><h4>'+e.mmap_eventname+'</h4><p><a href="'+e.mmap_url+'" target="_blank">'+e.mmap_url+"</a></p></div>"}).open(this.map,o)}),o});new MarkerClusterer(this.map,this.markers,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})}}})});
//# sourceMappingURL=mf-map.min.js.map
"use strict";function formatDate(e){var t=new Date(e),a=t.getDate(),r=t.getMonth(),s=t.getFullYear();return["January","February","March","April","May","June","July","August","September","October","November","December"][r]+", "+a+" "+s}jQuery(document).ready(function(){var r=new Date,s=!0,a=[];Vue.use(VueTables.ClientTable),Vue.use(VueTables.Event);new Vue({el:"#directory",data:{columns:["faire_name","event_start_dt","venue_address_city","venue_address_country","venue_address_street","venue_address_state","event_dt","category"],tableData:[],filteredData:[],options:{headings:{faire_name:"Name",event_start_dt:"Date",venue_address_city:"Location",venue_address_country:"Country"},templates:{venue_address_city:function(e,t,a){var r=t.venue_address_city;return t.venue_address_state&&(r+=", "+t.venue_address_state),r}},columnsDisplay:{venue_address_country:"desktop"},columnsClasses:{faire_name:"col-name",event_start_dt:"col-date",venue_address_city:"col-location",venue_address_country:"col-country",venue_address_street:"col-hidden",venue_address_state:"col-hidden",event_dt:"col-hidden",category:"col-hidden"},pagination:{chunk:5}},filterVal:"",pastFaires:!1,types:["Featured","Mini","School"],buttonMessage:"Show Past Faires",map:null,markerCluster:null,mapDefaultZoom:2,mapMinZoom:2,mapMaxZoom:20,mapDefaultPos:{lat:29.1070772,lng:-4.2299966},markers:""},created:function(){var t=this;axios.get("/query/?type=map").then(function(e){t.$refs.loadingIndicator.classList.add("hidden"),t.outputData=e.data.Locations,Object.keys(t.outputData).forEach(function(e){t.outputData[e].event_start_dt=Date.parse(t.outputData[e].event_start_dt)}),t.detectBrowser(),t.initMap()}).catch(function(e){console.log(e),t.$refs.loadingIndicator.classList.add("hidden"),t.$refs.errorIndicator.classList.remove("hidden")})},updated:function(){s=!1},methods:{detectBrowser:function(){var e=navigator.userAgent,t=this.$refs.map;-1!=e.indexOf("iPhone")||-1!=e.indexOf("Android")?(t.style.width="100%",t.style.height="300px"):(t.style.width="100%",t.style.height="450px")},initMap:function(){this.$refs.mapTableWrapper.classList.remove("map-table-hidden"),1==s&&this.$refs.directoryGrid.setOrder("event_start_dt","asc"),this.tableData=this.outputData.filter(function(e){var t=new Date(e.event_start_dt);if(r<t)return e}),this.filteredData=this.tableData;var e=new google.maps.StyledMapType([{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],{name:"Styled Map"}),t=this.$refs.map,a={center:this.mapDefaultPos,zoom:this.mapDefaultZoom,minZoom:this.mapMinZoom,maxZoom:this.mapMaxZoom,restriction:{latLngBounds:{north:85,south:-85,west:-180,east:180},strictBounds:!0},mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}};this.map=new google.maps.Map(t,a),this.map.mapTypes.set("styled_map",e),this.map.setMapTypeId("styled_map"),this.addMarkers()},getLocation:function(){var e=new google.maps.InfoWindow,a=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};a.map.setCenter(t),a.map.setZoom(8)},function(){a.handleLocationError(!0,e,a.map.getCenter())}):a.handleLocationError(!1,e,a.map.getCenter())},handleLocationError:function(e,t,a){console.error("User location check failed")},searchFilter:function(e){this.$refs.directoryGrid.setFilter(this.filterVal),this.addMarkers()},psFilter:function(e){1==this.pastFaires?(this.buttonMessage="Show Past Faires",this.tableData=this.outputData.filter(function(e){var t=new Date(e.event_start_dt);if(r<t)return e})):(this.buttonMessage="Show Upcoming Faires",this.tableData=this.outputData.filter(function(e){return e})),this.filteredData=this.tableData.filter(function(e){var t=e.category;return a.length<1?e:a.includes(t)?e:void 0}),this.addMarkers()},typeFilter:function(e){if(console.log(e),1==e.originalTarget.checked&&(a.push(e.originalTarget._value),"Featured"==e.explicitOriginalTarget._value&&a.push("Flagship")),0==e.originalTarget.checked){var t=a.indexOf(e.originalTarget._value);-1!==t&&a.splice(t,1),"Featured"==e.explicitOriginalTarget._value&&a.splice("Flagship",1)}this.filteredData=this.tableData.filter(function(e){var t=e.category;return a.length<1?e:a.includes(t)?e:void 0}),this.addMarkers()},filterOverride:function(e){e.preventDefault()},onRowClick:function(e){var t={lat:parseFloat(e.row.lat),lng:parseFloat(e.row.lng)};this.map.panTo(t),this.map.setZoom(16)},addMarkers:function(){for(var e=0;e<this.markers.length;e++)this.markers[e].setMap(null);this.markers=new Array,this.markerCluster&&this.markerCluster.clearMarkers();var s={path:google.maps.SymbolPath.CIRCLE,scale:6,fillOpacity:1,strokeOpacity:0};this.markers=this.filteredData.map(function(e,t){switch(e.category){case"Flagship":case"Featured":s.fillColor="#D42410";break;case"School":s.fillColor="#F5A623";break;default:s.fillColor="#67D0F7"}var a={lat:parseFloat(e.lat)+Math.random()/1e3,lng:parseFloat(e.lng)+Math.random()/1e3},r=new google.maps.Marker({icon:s,position:a,label:""});return r.addListener("click",function(){new google.maps.InfoWindow({content:'<div style=""><h4>'+e.faire_name+"</h4><p>"+e.venue_address_street+"</p><p>"+e.event_dt+'</p><p><a href="'+e.faire_url+'" target="_blank">'+e.faire_url+"</a></p></div>"}).open(this.map,r)}),r}),this.markerCluster=new MarkerClusterer(this.map,this.markers,{imagePath:"/wp-content/themes/makerfaire/js/mf-map/markers/m"})}}});jQuery("label[for=Mini] span").html("Community")});
//# sourceMappingURL=mf-map.min.js.map
// Compiled file - any changes will be overwritten by grunt task

!function(angular){"use strict";angular.module("faireMapsApp",["angularUtils.directives.dirPagination","ordinal"]),angular.module("faireMapsApp").factory("FaireMapsSharedData",["$q",function($q){var defer=$q.defer();return{gmarkers1:[],infowindow:void 0,mapDone:function(){return defer.promise},setMapDone:function(){defer.notify(!0)}}}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").factory("GMapsInitializer",["$window","$q",function($window,$q){var mapsDefer=$q.defer();$window.googleMapsInitialized=mapsDefer.resolve;return function(asyncUrl){var script=document.createElement("script");script.src=asyncUrl,document.body.appendChild(script)}("https://maps.googleapis.com/maps/api/js?key=AIzaSyAWCxi-jR1anl8W8doVmAdeXwhts9LWQqc&v=3.exp&callback=googleMapsInitialized"),mapsDefer.promise}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").controller("MapCtrl",["$http","$rootScope","$filter","FaireMapsSharedData",function($http,$rootScope,$filter,FaireMapsSharedData){var ctrl=this,faireFilters={filters:["Flagship","Featured","Mini"],search:"",pastEvents:!1};ctrl.pastEvents=!1,$rootScope.$on("toggleMapFilter",function(event,args){var index=faireFilters.filters.indexOf(args.filter);args.state&&index<0?faireFilters.filters.push(args.filter):!args.state&&index>-1&&faireFilters.filters.splice(index,1),ctrl.applyMapFilters()}),ctrl.toggleBox=function(type){jQuery(".filters faires-map-filter").each(function(index,obj){var filter=jQuery(obj).attr("filter");index=faireFilters.filters.indexOf(filter);filter!==type?(jQuery(obj).find("input").prop("checked",!1),index>-1&&faireFilters.filters.splice(index,1)):(jQuery(obj).find("input").prop("checked",!0),index<0&&faireFilters.filters.push(filter))}),ctrl.applyMapFilters()},ctrl.applyMapFilters=function(){FaireMapsSharedData.infowindow.close(),ctrl.pastPresent={past:0,present:0},faireFilters.search=ctrl.filterText,faireFilters.pastEvents=ctrl.pastEvents;var newModel=[],todaysDate=new Date;FaireMapsSharedData.gmarkers1.map(function(marker){var rowData=marker.dataRowSrc;(function(marker){return!faireFilters.search||function checkForValue(json,value){for(var key in json)if("object"==typeof json[key])checkForValue(json[key],value);else if("string"==typeof json[key]&&json[key].toLowerCase().match(value))return!0;return!1}(marker,faireFilters.search.toLowerCase())})(rowData)&&function(marker){return faireFilters.filters.indexOf(marker.category)>-1}(rowData)&&function(marker){var eventDate;if("[object Date]"!==Object.prototype.toString.call(marker.event_end_dt)||isNaN(marker.event_end_dt.getTime())){if("[object Date]"!==Object.prototype.toString.call(marker.event_start_dt)||isNaN(marker.event_start_dt.getTime()))return ctrl.pastPresent.present++,!0;eventDate=marker.event_start_dt}else eventDate=marker.event_end_dt;var event_date=new Date(eventDate);event_date.setDate(event_date.getDate()+1),event_date.setHours(0,0,0,0);var isInPast=event_date.getTime()<todaysDate.getTime();return isInPast?ctrl.pastPresent.past++:ctrl.pastPresent.present++,faireFilters.pastEvents==isInPast}(rowData)?(newModel.push(rowData),marker.setVisible(!0)):(ctrl.pastPresent.past++,marker.setVisible(!1))}),ctrl.faireMarkers=newModel},$http.get("/query/?type=map").then(function(response){ctrl.faireMarkers=response&&response.data&&response.data.Locations,FaireMapsSharedData.mapDone().then(null,null,function(){ctrl.applyMapFilters()})},function(){})}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").component("fairesMapFilter",{template:'<div class="checkbox">        <label>          <input type="checkbox" class="checkbox-fa-icon" ng-model="$ctrl.defaultState" ng-click="$ctrl.toggleFilter()">          <i class="fa fa-circle-o"></i>          <i class="fa fa-circle"></i>          <ng-transclude></ng-transclude>        </label>      </div>',transclude:!0,bindings:{filter:"@",defaultState:"="},replace:!0,controller:["$rootScope",function($rootScope){var ctrl=this;$rootScope.$on("toggleMapSearch",function(){ctrl.defaultState=!0}),ctrl.toggleFilter=function(){var toggleState={filter:ctrl.filter,state:ctrl.defaultState};$rootScope.$emit("toggleMapFilter",toggleState)}}]})}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").component("fairesGoogleMap",{bindings:{mapId:"@id",mapData:"="},controller:["$rootScope","GMapsInitializer","FaireMapsSharedData","$filter",function($rootScope,GMapsInitializer,FaireMapsSharedData,$filter){var gMap,ctrl=this;GMapsInitializer.then(function(){!function(mapId){var customMapType=new google.maps.StyledMapType([{stylers:[{hue:"#FFFFFF"},{visibility:"simplified"},{gamma:2},{weight:.5}]},{elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"landscape",stylers:[{color:"#FFFFFF"}]},{featureType:"all",elementType:"geometry",stylers:[{color:"#FFFFFF"},{visibility:"on"}]},{featureType:"water",stylers:[{color:"#d0eafc"}]},{featureType:"administrative.country",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"off"}]}],{name:"Custom Style"});function displayMarkerInfo(){var marker_map=this.getMap();FaireMapsSharedData.infowindow.setContent('<div id="content"><h3 class="firstHeading">'+this.title+'</h3><div id="bodyContent"><p>'+(this.dataRowSrc.venue_address_city||"")+(this.dataRowSrc.venue_address_state&&", "+this.dataRowSrc.venue_address_state||"")+(this.dataRowSrc.venue_address_country&&", "+this.dataRowSrc.venue_address_country+" "||"")+(this.dataRowSrc.event_dt||"")+"</p><p>"+(this.dataRowSrc.faire_url&&'<a href="'+this.dataRowSrc.faire_url+'" target="_blank">'+this.dataRowSrc.faire_url+"</a>"||"")+"</p></div></div>"),FaireMapsSharedData.infowindow.open(marker_map,this)}(gMap=new google.maps.Map(document.getElementById(mapId),{center:{lat:23.9758543,lng:1.4487502},disableDefaultUI:!0,scrollwheel:!1,zoomControl:!0,minZoom:1,zoom:2})).mapTypes.set("custom_style",customMapType),gMap.setMapTypeId("custom_style"),FaireMapsSharedData.infowindow=new google.maps.InfoWindow({content:void 0}),function(data){for(var row,gMarker,gMarkerIcon,gMarkerZIndex,i=0;i<data.length;i++){switch(row=data[i],gMarkerIcon={path:google.maps.SymbolPath.CIRCLE,scale:5,fillOpacity:1,strokeOpacity:0},gMarkerZIndex=1,row.category){case"Flagship":gMarkerIcon.fillColor="#D42410",gMarkerIcon.scale=11,gMarkerZIndex=2;break;case"Featured":gMarkerIcon.fillColor="#085a7e",gMarkerIcon.scale=8;break;case"School":gMarkerIcon.fillColor="#7ED321";break;default:gMarkerIcon.fillColor="#67D0F7"}gMarker=new google.maps.Marker({position:{lat:parseFloat(row.lat),lng:parseFloat(row.lng)},icon:gMarkerIcon,map:gMap,animation:google.maps.Animation.DROP,title:row.name,description:row.description,category:row.category,zIndex:gMarkerZIndex,dataRowSrc:row}),google.maps.event.addListener(gMarker,"mouseover",displayMarkerInfo),gMarker.dataRowSrc.event_end_dt=new Date(gMarker.dataRowSrc.event_end_dt),gMarker.dataRowSrc.event_start_dt=new Date(gMarker.dataRowSrc.event_start_dt),FaireMapsSharedData.gmarkers1.push(gMarker)}FaireMapsSharedData.setMapDone()}(ctrl.mapData)}(ctrl.mapId)})}]})}(window.angular);
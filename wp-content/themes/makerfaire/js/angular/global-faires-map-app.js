// Compiled file - any changes will be overwritten by grunt task
!function(angular){"use strict";angular.module("faireMapsApp",["angularUtils.directives.dirPagination","ordinal"]),angular.module("faireMapsApp").factory("FaireMapsSharedData",["$q",function($q){var defer=$q.defer(),FaireMapsSharedData={gmarkers1:[],infowindow:void 0,mapDone:function(){return defer.promise},setMapDone:function(){defer.notify(!0)}};return FaireMapsSharedData}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").factory("GMapsInitializer",["$window","$q",function($window,$q){var asyncUrl="https://maps.googleapis.com/maps/api/js??v=3.exp&callback=googleMapsInitialized",mapsDefer=$q.defer();$window.googleMapsInitialized=mapsDefer.resolve;var asyncLoad=function(asyncUrl){var script=document.createElement("script");script.src=asyncUrl,document.body.appendChild(script)};return asyncLoad(asyncUrl),mapsDefer.promise}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").controller("MapCtrl",["$http","$rootScope","$filter","FaireMapsSharedData",function($http,$rootScope,$filter,FaireMapsSharedData){var ctrl=this,faireFilters={filters:["Flagship","Featured","Mini"],search:"",pastEvents:!1};ctrl.pastEvents=!1,$rootScope.$on("toggleMapFilter",function(event,args){var index=faireFilters.filters.indexOf(args.filter);args.state&&0>index?faireFilters.filters.push(args.filter):!args.state&&index>-1&&faireFilters.filters.splice(index,1),ctrl.applyMapFilters()}),ctrl.applyMapFilters=function(){function containsString(marker){function checkForValue(json,value){for(var key in json){if("object"==typeof json[key])return checkForValue(json[key],value);if("string"==typeof json[key]&&json[key].toLowerCase().match(value))return!0}return!1}return faireFilters.search?checkForValue(marker,faireFilters.search.toLowerCase()):!0}function isTypeToggled(marker){return faireFilters.filters.indexOf(marker.category)>-1}function isDateOk(marker){var eventDate;if("[object Date]"===Object.prototype.toString.call(marker.event_end_dt)&&"0000-00-00 00:00:00"==marker.event_end_dt)eventDate=marker.event_end_dt;else{if("[object Date]"!==Object.prototype.toString.call(marker.event_start_dt)||"0000-00-00 00:00:00"==marker.event_start_dt)return ctrl.pastPresent.present++,!0;eventDate=marker.event_start_dt}var isInPast=new Date(eventDate).getTime()<todaysDate.getTime();return isInPast?ctrl.pastPresent.past++:ctrl.pastPresent.present++,faireFilters.pastEvents==isInPast}FaireMapsSharedData.infowindow.close(),ctrl.pastPresent={past:0,present:0},faireFilters.search=ctrl.filterText,faireFilters.pastEvents=ctrl.pastEvents;var newModel=[],todaysDate=new Date;FaireMapsSharedData.gmarkers1.map(function(marker){var rowData=marker.dataRowSrc;containsString(rowData)&&isTypeToggled(rowData)&&isDateOk(rowData)?(newModel.push(rowData),marker.setVisible(!0)):(ctrl.pastPresent.past++,marker.setVisible(!1))}),ctrl.faireMarkers=newModel},$http.get("/query/?type=map").then(function(response){ctrl.faireMarkers=response&&response.data&&response.data.Locations,FaireMapsSharedData.mapDone().then(null,null,function(){ctrl.applyMapFilters()})},function(){})}])}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").component("fairesMapFilter",{template:'<div class="checkbox">        <label>          <input type="checkbox" class="checkbox-fa-icon" ng-model="$ctrl.defaultState" ng-click="$ctrl.toggleFilter()">          <i class="fa fa-square-o"></i>          <i class="fa fa-check-square-o"></i>          <ng-transclude></ng-transclude>        </label>      </div>',transclude:!0,bindings:{filter:"@",defaultState:"="},replace:!0,controller:["$rootScope",function($rootScope){var ctrl=this;$rootScope.$on("toggleMapSearch",function(){ctrl.defaultState=!0}),ctrl.toggleFilter=function(){var toggleState={filter:ctrl.filter,state:ctrl.defaultState};$rootScope.$emit("toggleMapFilter",toggleState)}}]})}(window.angular),function(angular){"use strict";angular.module("faireMapsApp").component("fairesGoogleMap",{bindings:{mapId:"@id",mapData:"="},controller:["$rootScope","GMapsInitializer","FaireMapsSharedData","$filter",function($rootScope,GMapsInitializer,FaireMapsSharedData,$filter){function initMap(mapId){function setMarkers(data){for(var row,gMarker,gMarkerIcon,gMarkerZIndex,i=0;i<data.length;i++){switch(row=data[i],gMarkerIcon={path:google.maps.SymbolPath.CIRCLE,scale:5,fillOpacity:.5,strokeOpacity:0},gMarkerZIndex=1,row.category){case"Flagship":gMarkerIcon.fillColor="#D42410",gMarkerIcon.scale=11,gMarkerZIndex=2;break;case"Featured":gMarkerIcon.fillColor="#01A3E0",gMarkerIcon.scale=9;break;case"School":gMarkerIcon.fillColor="#7ED321";break;default:gMarkerIcon.fillColor="#67D0F7"}gMarker=new google.maps.Marker({position:{lat:parseFloat(row.lat),lng:parseFloat(row.lng)},icon:gMarkerIcon,map:gMap,animation:google.maps.Animation.DROP,title:row.name,description:row.description,category:row.category,zIndex:gMarkerZIndex,dataRowSrc:row}),google.maps.event.addListener(gMarker,"mouseover",displayMarkerInfo),gMarker.dataRowSrc.event_end_dt=new Date(gMarker.dataRowSrc.event_end_dt),gMarker.dataRowSrc.event_start_dt=new Date(gMarker.dataRowSrc.event_start_dt),FaireMapsSharedData.gmarkers1.push(gMarker)}FaireMapsSharedData.setMapDone()}function displayMarkerInfo(){var marker_map=this.getMap();FaireMapsSharedData.infowindow.setContent('<div id="content"><h3 class="firstHeading">'+this.title+'</h3><div id="bodyContent"><p>'+(this.dataRowSrc.venue_address_city||"")+(this.dataRowSrc.venue_address_state&&", "+this.dataRowSrc.venue_address_state||"")+(this.dataRowSrc.venue_address_country&&", "+this.dataRowSrc.venue_address_country+" "||"")+(this.dataRowSrc.event_dt||"")+"</p><p>"+(this.dataRowSrc.faire_url&&'<a href="'+this.dataRowSrc.faire_url+'" target="blank">'+this.dataRowSrc.faire_url+"</a>"||"")+"</p></div></div>"),FaireMapsSharedData.infowindow.open(marker_map,this)}var customMapType=new google.maps.StyledMapType([{stylers:[{hue:"#FFFFFF"},{visibility:"simplified"},{gamma:2},{weight:.5}]},{elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{color:"#FFFFFF"}]},{featureType:"water",stylers:[{color:"#EDF2F5"}]}],{name:"Custom Style"}),customMapTypeId="custom_style";gMap=new google.maps.Map(document.getElementById(mapId),{center:{lat:32,lng:-70},disableDefaultUI:!0,scrollwheel:!1,zoomControl:!0,minZoom:2,zoom:3}),gMap.mapTypes.set(customMapTypeId,customMapType),gMap.setMapTypeId(customMapTypeId),FaireMapsSharedData.infowindow=new google.maps.InfoWindow({content:void 0}),setMarkers(ctrl.mapData)}var gMap,ctrl=this;GMapsInitializer.then(function(){initMap(ctrl.mapId),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){gMap.setCenter(new google.maps.LatLng(position.coords.latitude,position.coords.longitude))})})}]})}(window.angular);